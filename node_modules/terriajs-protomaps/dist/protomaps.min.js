var protomaps=(()=>{var xr=Object.create;var we=Object.defineProperty;var yr=Object.getOwnPropertyDescriptor;var br=Object.getOwnPropertyNames,pt=Object.getOwnPropertySymbols,gr=Object.getPrototypeOf,xt=Object.prototype.hasOwnProperty,wr=Object.prototype.propertyIsEnumerable;var Ue=(e,t,r)=>t in e?we(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,yt=(e,t)=>{for(var r in t||(t={}))xt.call(t,r)&&Ue(e,r,t[r]);if(pt)for(var r of pt(t))wr.call(t,r)&&Ue(e,r,t[r]);return e};var bt=e=>we(e,"__esModule",{value:!0});var E=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),vr=(e,t)=>{bt(e);for(var r in t)we(e,r,{get:t[r],enumerable:!0})},_r=(e,t,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of br(t))!xt.call(e,i)&&i!=="default"&&we(e,i,{get:()=>t[i],enumerable:!(r=yr(t,i))||r.enumerable});return e},q=e=>_r(bt(we(e!=null?xr(gr(e)):{},"default",e&&e.__esModule&&"default"in e?{get:()=>e.default,enumerable:!0}:{value:e,enumerable:!0})),e);var re=(e,t,r)=>(Ue(e,typeof t!="symbol"?t+"":t,r),r);var D=(e,t,r)=>new Promise((i,n)=>{var a=l=>{try{o(r.next(l))}catch(h){n(h)}},s=l=>{try{o(r.throw(l))}catch(h){n(h)}},o=l=>l.done?i(l.value):Promise.resolve(l.value).then(a,s);o((r=r.apply(e,t)).next())});var U=E((Pi,gt)=>{"use strict";gt.exports=ie;function ie(e,t){this.x=e,this.y=t}ie.prototype={clone:function(){return new ie(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[0]*this.x+e[1]*this.y,r=e[2]*this.x+e[3]*this.y;return this.x=t,this.y=r,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),i=t*this.x-r*this.y,n=r*this.x+t*this.y;return this.x=i,this.y=n,this},_rotateAround:function(e,t){var r=Math.cos(e),i=Math.sin(e),n=t.x+r*(this.x-t.x)-i*(this.y-t.y),a=t.y+i*(this.x-t.x)+r*(this.y-t.y);return this.x=n,this.y=a,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}};ie.convert=function(e){return e instanceof ie?e:Array.isArray(e)?new ie(e[0],e[1]):e}});var We=E((Ci,wt)=>{"use strict";var Fr=U();wt.exports=ne;function ne(e,t,r,i,n){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=i,this._values=n,e.readFields(zr,this,t)}function zr(e,t,r){e==1?t.id=r.readVarint():e==2?Lr(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function Lr(e,t){for(var r=e.readVarint()+e.pos;e.pos<r;){var i=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[i]=n}}ne.types=["Unknown","Point","LineString","Polygon"];ne.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,i=0,n=0,a=0,s=[],o;e.pos<t;){if(i<=0){var l=e.readVarint();r=l&7,i=l>>3}if(i--,r===1||r===2)n+=e.readSVarint(),a+=e.readSVarint(),r===1&&(o&&s.push(o),o=[]),o.push(new Fr(n,a));else if(r===7)o&&o.push(o[0].clone());else throw new Error("unknown command "+r)}return o&&s.push(o),s};ne.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,i=0,n=0,a=0,s=1/0,o=-1/0,l=1/0,h=-1/0;e.pos<t;){if(i<=0){var d=e.readVarint();r=d&7,i=d>>3}if(i--,r===1||r===2)n+=e.readSVarint(),a+=e.readSVarint(),n<s&&(s=n),n>o&&(o=n),a<l&&(l=a),a>h&&(h=a);else if(r!==7)throw new Error("unknown command "+r)}return[s,l,o,h]};ne.prototype.toGeoJSON=function(e,t,r){var i=this.extent*Math.pow(2,r),n=this.extent*e,a=this.extent*t,s=this.loadGeometry(),o=ne.types[this.type],l,h;function d(x){for(var b=0;b<x.length;b++){var w=x[b],u=180-(w.y+a)*360/i;x[b]=[(w.x+n)*360/i-180,360/Math.PI*Math.atan(Math.exp(u*Math.PI/180))-90]}}switch(this.type){case 1:var c=[];for(l=0;l<s.length;l++)c[l]=s[l][0];s=c,d(s);break;case 2:for(l=0;l<s.length;l++)d(s[l]);break;case 3:for(s=Mr(s),l=0;l<s.length;l++)for(h=0;h<s[l].length;h++)d(s[l][h]);break}s.length===1?s=s[0]:o="Multi"+o;var p={type:"Feature",geometry:{type:o,coordinates:s},properties:this.properties};return"id"in this&&(p.id=this.id),p};function Mr(e){var t=e.length;if(t<=1)return[e];for(var r=[],i,n,a=0;a<t;a++){var s=kr(e[a]);s!==0&&(n===void 0&&(n=s<0),n===s<0?(i&&r.push(i),i=[e[a]]):i.push(e[a]))}return i&&r.push(i),r}function kr(e){for(var t=0,r=0,i=e.length,n=i-1,a,s;r<i;n=r++)a=e[r],s=e[n],t+=(s.x-a.x)*(a.y+s.y);return t}});var Oe=E((Ti,_t)=>{"use strict";var Sr=We();_t.exports=vt;function vt(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Pr,this,t),this.length=this._features.length}function Pr(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(Cr(r))}function Cr(e){for(var t=null,r=e.readVarint()+e.pos;e.pos<r;){var i=e.readVarint()>>3;t=i===1?e.readString():i===2?e.readFloat():i===3?e.readDouble():i===4?e.readVarint64():i===5?e.readVarint():i===6?e.readSVarint():i===7?e.readBoolean():null}return t}vt.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new Sr(this._pbf,t,this.extent,this._keys,this._values)}});var zt=E((Bi,Ft)=>{"use strict";var Tr=Oe();Ft.exports=Br;function Br(e,t){this.layers=e.readFields(Dr,{},t)}function Dr(e,t,r){if(e===3){var i=new Tr(r,r.readVarint()+r.pos);i.length&&(t[i.name]=i)}}});var Lt=E((Di,Ie)=>{Ie.exports.VectorTile=zt();Ie.exports.VectorTileFeature=We();Ie.exports.VectorTileLayer=Oe()});var Mt=E(He=>{He.read=function(e,t,r,i,n){var a,s,o=n*8-i-1,l=(1<<o)-1,h=l>>1,d=-7,c=r?n-1:0,p=r?-1:1,x=e[t+c];for(c+=p,a=x&(1<<-d)-1,x>>=-d,d+=o;d>0;a=a*256+e[t+c],c+=p,d-=8);for(s=a&(1<<-d)-1,a>>=-d,d+=i;d>0;s=s*256+e[t+c],c+=p,d-=8);if(a===0)a=1-h;else{if(a===l)return s?NaN:(x?-1:1)*(1/0);s=s+Math.pow(2,i),a=a-h}return(x?-1:1)*s*Math.pow(2,a-i)};He.write=function(e,t,r,i,n,a){var s,o,l,h=a*8-n-1,d=(1<<h)-1,c=d>>1,p=n===23?Math.pow(2,-24)-Math.pow(2,-77):0,x=i?0:a-1,b=i?1:-1,w=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,s=d):(s=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-s))<1&&(s--,l*=2),s+c>=1?t+=p/l:t+=p*Math.pow(2,1-c),t*l>=2&&(s++,l/=2),s+c>=d?(o=0,s=d):s+c>=1?(o=(t*l-1)*Math.pow(2,n),s=s+c):(o=t*Math.pow(2,c-1)*Math.pow(2,n),s=0));n>=8;e[r+x]=o&255,x+=b,o/=256,n-=8);for(s=s<<n|o,h+=n;h>0;e[r+x]=s&255,x+=b,s/=256,h-=8);e[r+x-b]|=w*128}});var Bt=E((Yi,Tt)=>{"use strict";Tt.exports=k;var Re=Mt();function k(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}k.Varint=0;k.Fixed64=1;k.Bytes=2;k.Fixed32=5;var Ge=(1<<16)*(1<<16),kt=1/Ge,Xr=12,St=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");k.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var i=this.readVarint(),n=i>>3,a=this.pos;this.type=i&7,e(n,t,this),this.pos===a&&this.skip(i)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=Ve(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=Ct(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=Ve(this.buf,this.pos)+Ve(this.buf,this.pos+4)*Ge;return this.pos+=8,e},readSFixed64:function(){var e=Ve(this.buf,this.pos)+Ct(this.buf,this.pos+4)*Ge;return this.pos+=8,e},readFloat:function(){var e=Re.read(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Re.read(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t=this.buf,r,i;return i=t[this.pos++],r=i&127,i<128||(i=t[this.pos++],r|=(i&127)<<7,i<128)||(i=t[this.pos++],r|=(i&127)<<14,i<128)||(i=t[this.pos++],r|=(i&127)<<21,i<128)?r:(i=t[this.pos],r|=(i&15)<<28,Yr(r,e,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=Xr&&St?Hr(this.buf,t,e):Or(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==k.Bytes)return e.push(this.readVarint(t));var r=Z(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==k.Bytes)return e.push(this.readSVarint());var t=Z(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==k.Bytes)return e.push(this.readBoolean());var t=Z(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==k.Bytes)return e.push(this.readFloat());var t=Z(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==k.Bytes)return e.push(this.readDouble());var t=Z(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==k.Bytes)return e.push(this.readFixed32());var t=Z(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==k.Bytes)return e.push(this.readSFixed32());var t=Z(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==k.Bytes)return e.push(this.readFixed64());var t=Z(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==k.Bytes)return e.push(this.readSFixed64());var t=Z(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=e&7;if(t===k.Varint)for(;this.buf[this.pos++]>127;);else if(t===k.Bytes)this.pos=this.readVarint()+this.pos;else if(t===k.Fixed32)this.pos+=4;else if(t===k.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+t)},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),se(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),se(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),se(this.buf,e&-1,this.pos),se(this.buf,Math.floor(e*kt),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),se(this.buf,e&-1,this.pos),se(this.buf,Math.floor(e*kt),this.pos+4),this.pos+=8},writeVarint:function(e){if(e=+e||0,e>268435455||e<0){Ir(e,this);return}this.realloc(4),this.buf[this.pos++]=e&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=(e>>>=7)&127|(e>127?128:0),!(e<=127)&&(this.buf[this.pos++]=e>>>7&127)))},writeSVarint:function(e){this.writeVarint(e<0?-e*2-1:e*2)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(e.length*4),this.pos++;var t=this.pos;this.pos=Gr(this.buf,e,this.pos);var r=this.pos-t;r>=128&&Pt(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),Re.write(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Re.write(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var i=this.pos-r;i>=128&&Pt(r,i,this),this.pos=r-1,this.writeVarint(i),this.pos+=i},writeMessage:function(e,t,r){this.writeTag(e,k.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,Ar,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Er,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,jr,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,qr,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,$r,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Zr,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Nr,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Ur,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,Wr,t)},writeBytesField:function(e,t){this.writeTag(e,k.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,k.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,k.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,k.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,k.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,k.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,k.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,k.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,k.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,k.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};function Yr(e,t,r){var i=r.buf,n,a;if(a=i[r.pos++],n=(a&112)>>4,a<128||(a=i[r.pos++],n|=(a&127)<<3,a<128)||(a=i[r.pos++],n|=(a&127)<<10,a<128)||(a=i[r.pos++],n|=(a&127)<<17,a<128)||(a=i[r.pos++],n|=(a&127)<<24,a<128)||(a=i[r.pos++],n|=(a&1)<<31,a<128))return ae(e,n,t);throw new Error("Expected varint not more than 10 bytes")}function Z(e){return e.type===k.Bytes?e.readVarint()+e.pos:e.pos+1}function ae(e,t,r){return r?t*4294967296+(e>>>0):(t>>>0)*4294967296+(e>>>0)}function Ir(e,t){var r,i;if(e>=0?(r=e%4294967296|0,i=e/4294967296|0):(r=~(-e%4294967296),i=~(-e/4294967296),r^4294967295?r=r+1|0:(r=0,i=i+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),Rr(r,i,t),Vr(i,t)}function Rr(e,t,r){r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos++]=e&127|128,e>>>=7,r.buf[r.pos]=e&127}function Vr(e,t){var r=(e&7)<<4;t.buf[t.pos++]|=r|((e>>>=3)?128:0),!!e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),!!e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),!!e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),!!e&&(t.buf[t.pos++]=e&127|((e>>>=7)?128:0),!!e&&(t.buf[t.pos++]=e&127)))))}function Pt(e,t,r){var i=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(Math.LN2*7));r.realloc(i);for(var n=r.pos-1;n>=e;n--)r.buf[n+i]=r.buf[n]}function Ar(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Er(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function qr(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function $r(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function jr(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function Zr(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function Nr(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function Ur(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function Wr(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function Ve(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+e[t+3]*16777216}function se(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function Ct(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function Or(e,t,r){for(var i="",n=t;n<r;){var a=e[n],s=null,o=a>239?4:a>223?3:a>191?2:1;if(n+o>r)break;var l,h,d;o===1?a<128&&(s=a):o===2?(l=e[n+1],(l&192)==128&&(s=(a&31)<<6|l&63,s<=127&&(s=null))):o===3?(l=e[n+1],h=e[n+2],(l&192)==128&&(h&192)==128&&(s=(a&15)<<12|(l&63)<<6|h&63,(s<=2047||s>=55296&&s<=57343)&&(s=null))):o===4&&(l=e[n+1],h=e[n+2],d=e[n+3],(l&192)==128&&(h&192)==128&&(d&192)==128&&(s=(a&15)<<18|(l&63)<<12|(h&63)<<6|d&63,(s<=65535||s>=1114112)&&(s=null))),s===null?(s=65533,o=1):s>65535&&(s-=65536,i+=String.fromCharCode(s>>>10&1023|55296),s=56320|s&1023),i+=String.fromCharCode(s),n+=o}return i}function Hr(e,t,r){return St.decode(e.subarray(t,r))}function Gr(e,t,r){for(var i=0,n,a;i<t.length;i++){if(n=t.charCodeAt(i),n>55295&&n<57344)if(a)if(n<56320){e[r++]=239,e[r++]=191,e[r++]=189,a=n;continue}else n=a-55296<<10|n-56320|65536,a=null;else{n>56319||i+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):a=n;continue}else a&&(e[r++]=239,e[r++]=191,e[r++]=189,a=null);n<128?e[r++]=n:(n<2048?e[r++]=n>>6|192:(n<65536?e[r++]=n>>12|224:(e[r++]=n>>18|240,e[r++]=n>>12&63|128),e[r++]=n>>6&63|128),e[r++]=n&63|128)}return r}});var Nt=E((Ke,et)=>{(function(e,t){typeof Ke=="object"&&typeof et!="undefined"?et.exports=t():typeof define=="function"&&define.amd?define(t):(e=e||self,e.TinyQueue=t())})(Ke,function(){"use strict";var e=function(i,n){if(i===void 0&&(i=[]),n===void 0&&(n=t),this.data=i,this.length=this.data.length,this.compare=n,this.length>0)for(var a=(this.length>>1)-1;a>=0;a--)this._down(a)};e.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},e.prototype.pop=function(){if(this.length!==0){var i=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),i}},e.prototype.peek=function(){return this.data[0]},e.prototype._up=function(i){for(var n=this,a=n.data,s=n.compare,o=a[i];i>0;){var l=i-1>>1,h=a[l];if(s(o,h)>=0)break;a[i]=h,i=l}a[i]=o},e.prototype._down=function(i){for(var n=this,a=n.data,s=n.compare,o=this.length>>1,l=a[i];i<o;){var h=(i<<1)+1,d=a[h],c=h+1;if(c<this.length&&s(a[c],d)<0&&(h=c,d=a[c]),s(d,l)>=0)break;a[i]=d,i=h}a[i]=l};function t(r,i){return r<i?-1:r>i?1:0}return e})});var Wt=E((Ei,tt)=>{"use strict";var $e=Nt();$e.default&&($e=$e.default);tt.exports=Ut;tt.exports.default=Ut;function Ut(e,t,r){t=t||1;for(var i,n,a,s,o=0;o<e[0].length;o++){var l=e[0][o];(!o||l[0]<i)&&(i=l[0]),(!o||l[1]<n)&&(n=l[1]),(!o||l[0]>a)&&(a=l[0]),(!o||l[1]>s)&&(s=l[1])}var h=a-i,d=s-n,c=Math.min(h,d),p=c/2;if(c===0){var x=[i,n];return x.distance=0,x}for(var b=new $e(void 0,ri),w=i;w<a;w+=c)for(var u=n;u<s;u+=c)b.push(new H(w+p,u+p,p,e));var f=ni(e),m=new H(i+h/2,n+d/2,0,e);m.d>f.d&&(f=m);for(var g=b.length;b.length;){var y=b.pop();y.d>f.d&&(f=y,r&&console.log("found best %d after %d probes",Math.round(1e4*y.d)/1e4,g)),!(y.max-f.d<=t)&&(p=y.h/2,b.push(new H(y.x-p,y.y-p,p,e)),b.push(new H(y.x+p,y.y-p,p,e)),b.push(new H(y.x-p,y.y+p,p,e)),b.push(new H(y.x+p,y.y+p,p,e)),g+=4)}r&&(console.log("num probes: "+g),console.log("best distance: "+f.d));var v=[f.x,f.y];return v.distance=f.d,v}function ri(e,t){return t.max-e.max}function H(e,t,r,i){this.x=e,this.y=t,this.h=r,this.d=ii(e,t,i),this.max=this.d+this.h*Math.SQRT2}function ii(e,t,r){for(var i=!1,n=1/0,a=0;a<r.length;a++)for(var s=r[a],o=0,l=s.length,h=l-1;o<l;h=o++){var d=s[o],c=s[h];d[1]>t!=c[1]>t&&e<(c[0]-d[0])*(t-d[1])/(c[1]-d[1])+d[0]&&(i=!i),n=Math.min(n,ai(e,t,d,c))}return n===0?0:(i?1:-1)*Math.sqrt(n)}function ni(e){for(var t=0,r=0,i=0,n=e[0],a=0,s=n.length,o=s-1;a<s;o=a++){var l=n[a],h=n[o],d=l[0]*h[1]-h[0]*l[1];r+=(l[0]+h[0])*d,i+=(l[1]+h[1])*d,t+=d*3}return t===0?new H(n[0][0],n[0][1],0,e):new H(r/t,i/t,0,e)}function ai(e,t,r,i){var n=r[0],a=r[1],s=i[0]-n,o=i[1]-a;if(s!==0||o!==0){var l=((e-n)*s+(t-a)*o)/(s*s+o*o);l>1?(n=i[0],a=i[1]):l>0&&(n+=s*l,a+=o*l)}return s=e-n,o=t-a,s*s+o*o}});var Ht=E((Zi,Ot)=>{Ot.exports=function(e,t){var r=[],i=[null],n,a,s,o=0,l=0,h=0,d=0,c=0,p=0,x=0,b=0,w=0,u=0,f=0,m=0;if(e.length<2)return[];if(e.length===2)return h=Math.sqrt(Math.pow(e[1].x-e[0].x,2)+Math.pow(e[1].y-e[0].y,2)),[{length:h,beginIndex:0,beginDistance:0,endIndex:2,endDistance:h,angles:[null,null]}];for(d=Math.sqrt(Math.pow(e[1].x-e[0].x,2)+Math.pow(e[1].y-e[0].y,2)),o=1,l=e.length-1;o<l;o++)n=e[o-1],a=e[o],s=e[o+1],p=a.x-n.x,x=a.y-n.y,b=s.x-a.x,w=s.y-a.y,c=Math.sqrt(b*b+w*w),h+=d,u=Math.acos((p*b+x*w)/(d*c)),i.push(u),u>t&&(r.push({length:h-m,beginDistance:m,beginIndex:f,endIndex:o+1,endDistance:h,angles:i}),f=o,m=h,i=[u]),d=c;return i.push(null),o-f>0&&r.push({length:h-m+c,beginIndex:f,beginDistance:m,endIndex:o+1,endDistance:h+c,angles:i}),r}});var rr=E((ot,lt)=>{(function(e,t){typeof ot=="object"&&typeof lt!="undefined"?lt.exports=t():typeof define=="function"&&define.amd?define(t):(e=e||self).RBush=t()})(ot,function(){"use strict";function e(u,f,m,g,y){(function v(_,F,z,M,C){for(;M>z;){if(M-z>600){var S=M-z+1,T=F-z+1,be=Math.log(S),G=.5*Math.exp(2*be/3),ee=.5*Math.sqrt(be*G*(S-G)/S)*(T-S/2<0?-1:1),te=Math.max(z,Math.floor(F-T*G/S+ee)),pr=Math.min(M,Math.floor(F+(S-T)*G/S+ee));v(_,F,te,pr,C)}var Ye=_[F],ge=z,A=M;for(t(_,z,F),C(_[M],Ye)>0&&t(_,z,M);ge<A;){for(t(_,ge,A),ge++,A--;C(_[ge],Ye)<0;)ge++;for(;C(_[A],Ye)>0;)A--}C(_[z],Ye)===0?t(_,z,A):t(_,++A,M),A<=F&&(z=A+1),F<=A&&(M=A-1)}})(u,f,m||0,g||u.length-1,y||r)}function t(u,f,m){var g=u[f];u[f]=u[m],u[m]=g}function r(u,f){return u<f?-1:u>f?1:0}var i=function(u){u===void 0&&(u=9),this._maxEntries=Math.max(4,u),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function n(u,f,m){if(!m)return f.indexOf(u);for(var g=0;g<f.length;g++)if(m(u,f[g]))return g;return-1}function a(u,f){s(u,0,u.children.length,f,u)}function s(u,f,m,g,y){y||(y=b(null)),y.minX=1/0,y.minY=1/0,y.maxX=-1/0,y.maxY=-1/0;for(var v=f;v<m;v++){var _=u.children[v];o(y,u.leaf?g(_):_)}return y}function o(u,f){return u.minX=Math.min(u.minX,f.minX),u.minY=Math.min(u.minY,f.minY),u.maxX=Math.max(u.maxX,f.maxX),u.maxY=Math.max(u.maxY,f.maxY),u}function l(u,f){return u.minX-f.minX}function h(u,f){return u.minY-f.minY}function d(u){return(u.maxX-u.minX)*(u.maxY-u.minY)}function c(u){return u.maxX-u.minX+(u.maxY-u.minY)}function p(u,f){return u.minX<=f.minX&&u.minY<=f.minY&&f.maxX<=u.maxX&&f.maxY<=u.maxY}function x(u,f){return f.minX<=u.maxX&&f.minY<=u.maxY&&f.maxX>=u.minX&&f.maxY>=u.minY}function b(u){return{children:u,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function w(u,f,m,g,y){for(var v=[f,m];v.length;)if(!((m=v.pop())-(f=v.pop())<=g)){var _=f+Math.ceil((m-f)/g/2)*g;e(u,_,f,m,y),v.push(f,_,_,m)}}return i.prototype.all=function(){return this._all(this.data,[])},i.prototype.search=function(u){var f=this.data,m=[];if(!x(u,f))return m;for(var g=this.toBBox,y=[];f;){for(var v=0;v<f.children.length;v++){var _=f.children[v],F=f.leaf?g(_):_;x(u,F)&&(f.leaf?m.push(_):p(u,F)?this._all(_,m):y.push(_))}f=y.pop()}return m},i.prototype.collides=function(u){var f=this.data;if(!x(u,f))return!1;for(var m=[];f;){for(var g=0;g<f.children.length;g++){var y=f.children[g],v=f.leaf?this.toBBox(y):y;if(x(u,v)){if(f.leaf||p(u,v))return!0;m.push(y)}}f=m.pop()}return!1},i.prototype.load=function(u){if(!u||!u.length)return this;if(u.length<this._minEntries){for(var f=0;f<u.length;f++)this.insert(u[f]);return this}var m=this._build(u.slice(),0,u.length-1,0);if(this.data.children.length)if(this.data.height===m.height)this._splitRoot(this.data,m);else{if(this.data.height<m.height){var g=this.data;this.data=m,m=g}this._insert(m,this.data.height-m.height-1,!0)}else this.data=m;return this},i.prototype.insert=function(u){return u&&this._insert(u,this.data.height-1),this},i.prototype.clear=function(){return this.data=b([]),this},i.prototype.remove=function(u,f){if(!u)return this;for(var m,g,y,v=this.data,_=this.toBBox(u),F=[],z=[];v||F.length;){if(v||(v=F.pop(),g=F[F.length-1],m=z.pop(),y=!0),v.leaf){var M=n(u,v.children,f);if(M!==-1)return v.children.splice(M,1),F.push(v),this._condense(F),this}y||v.leaf||!p(v,_)?g?(m++,v=g.children[m],y=!1):v=null:(F.push(v),z.push(m),m=0,g=v,v=v.children[0])}return this},i.prototype.toBBox=function(u){return u},i.prototype.compareMinX=function(u,f){return u.minX-f.minX},i.prototype.compareMinY=function(u,f){return u.minY-f.minY},i.prototype.toJSON=function(){return this.data},i.prototype.fromJSON=function(u){return this.data=u,this},i.prototype._all=function(u,f){for(var m=[];u;)u.leaf?f.push.apply(f,u.children):m.push.apply(m,u.children),u=m.pop();return f},i.prototype._build=function(u,f,m,g){var y,v=m-f+1,_=this._maxEntries;if(v<=_)return a(y=b(u.slice(f,m+1)),this.toBBox),y;g||(g=Math.ceil(Math.log(v)/Math.log(_)),_=Math.ceil(v/Math.pow(_,g-1))),(y=b([])).leaf=!1,y.height=g;var F=Math.ceil(v/_),z=F*Math.ceil(Math.sqrt(_));w(u,f,m,z,this.compareMinX);for(var M=f;M<=m;M+=z){var C=Math.min(M+z-1,m);w(u,M,C,F,this.compareMinY);for(var S=M;S<=C;S+=F){var T=Math.min(S+F-1,C);y.children.push(this._build(u,S,T,g-1))}}return a(y,this.toBBox),y},i.prototype._chooseSubtree=function(u,f,m,g){for(;g.push(f),!f.leaf&&g.length-1!==m;){for(var y=1/0,v=1/0,_=void 0,F=0;F<f.children.length;F++){var z=f.children[F],M=d(z),C=(S=u,T=z,(Math.max(T.maxX,S.maxX)-Math.min(T.minX,S.minX))*(Math.max(T.maxY,S.maxY)-Math.min(T.minY,S.minY))-M);C<v?(v=C,y=M<y?M:y,_=z):C===v&&M<y&&(y=M,_=z)}f=_||f.children[0]}var S,T;return f},i.prototype._insert=function(u,f,m){var g=m?u:this.toBBox(u),y=[],v=this._chooseSubtree(g,this.data,f,y);for(v.children.push(u),o(v,g);f>=0&&y[f].children.length>this._maxEntries;)this._split(y,f),f--;this._adjustParentBBoxes(g,y,f)},i.prototype._split=function(u,f){var m=u[f],g=m.children.length,y=this._minEntries;this._chooseSplitAxis(m,y,g);var v=this._chooseSplitIndex(m,y,g),_=b(m.children.splice(v,m.children.length-v));_.height=m.height,_.leaf=m.leaf,a(m,this.toBBox),a(_,this.toBBox),f?u[f-1].children.push(_):this._splitRoot(m,_)},i.prototype._splitRoot=function(u,f){this.data=b([u,f]),this.data.height=u.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},i.prototype._chooseSplitIndex=function(u,f,m){for(var g,y,v,_,F,z,M,C=1/0,S=1/0,T=f;T<=m-f;T++){var be=s(u,0,T,this.toBBox),G=s(u,T,m,this.toBBox),ee=(y=be,v=G,_=void 0,F=void 0,z=void 0,M=void 0,_=Math.max(y.minX,v.minX),F=Math.max(y.minY,v.minY),z=Math.min(y.maxX,v.maxX),M=Math.min(y.maxY,v.maxY),Math.max(0,z-_)*Math.max(0,M-F)),te=d(be)+d(G);ee<C?(C=ee,g=T,S=te<S?te:S):ee===C&&te<S&&(S=te,g=T)}return g||m-f},i.prototype._chooseSplitAxis=function(u,f,m){var g=u.leaf?this.compareMinX:l,y=u.leaf?this.compareMinY:h;this._allDistMargin(u,f,m,g)<this._allDistMargin(u,f,m,y)&&u.children.sort(g)},i.prototype._allDistMargin=function(u,f,m,g){u.children.sort(g);for(var y=this.toBBox,v=s(u,0,f,y),_=s(u,m-f,m,y),F=c(v)+c(_),z=f;z<m-f;z++){var M=u.children[z];o(v,u.leaf?y(M):M),F+=c(v)}for(var C=m-f-1;C>=f;C--){var S=u.children[C];o(_,u.leaf?y(S):S),F+=c(_)}return F},i.prototype._adjustParentBBoxes=function(u,f,m){for(var g=m;g>=0;g--)o(f[g],u)},i.prototype._condense=function(u){for(var f=u.length-1,m=void 0;f>=0;f--)u[f].children.length===0?f>0?(m=u[f-1].children).splice(m.indexOf(u[f]),1):this.clear():a(u[f],this.toBBox)},i})});var ki={};vr(ki,{CenteredSymbolizer:()=>it,CenteredTextSymbolizer:()=>j,CircleSymbolizer:()=>N,FlexSymbolizer:()=>Le,Font:()=>zi,GeomType:()=>$,GroupSymbolizer:()=>Me,IconSymbolizer:()=>er,Index:()=>ht,Labeler:()=>Pe,Labelers:()=>Ce,LineLabelSymbolizer:()=>fe,LineSymbolizer:()=>B,OffsetSymbolizer:()=>nt,OffsetTextSymbolizer:()=>J,PMTiles:()=>ve,PmtilesSource:()=>O,PolygonLabelSymbolizer:()=>de,PolygonSymbolizer:()=>P,ShieldSymbolizer:()=>je,Sprites:()=>Li,Static:()=>fr,TextSymbolizer:()=>ke,TileCache:()=>le,View:()=>ue,ZxySource:()=>oe,arr:()=>li,covering:()=>nr,createPattern:()=>oi,dark:()=>ce,exp:()=>R,filterFn:()=>Xe,getFont:()=>ct,getZoom:()=>ft,isCCW:()=>qt,isInRing:()=>Je,json_style:()=>Mi,labelRules:()=>ye,leafletLayer:()=>vi,light:()=>me,numberFn:()=>Ne,numberOrFn:()=>dt,paintRules:()=>xe,painter:()=>Se,pointInPolygon:()=>$t,pointMinDistToLines:()=>Zt,pointMinDistToPoints:()=>jt,toIndex:()=>W,transformGeom:()=>he,widthFn:()=>mt,wrap:()=>_e,xray:()=>st});var K=q(U());var Ae=q(U()),It=q(Lt()),Rt=q(Bt());var Dt=(e,t)=>e*Math.pow(2,t),Xt=(e,t)=>Dt(e.getUint16(t+1,!0),8)+e.getUint8(t,!0),Qr=(e,t)=>Dt(e.getUint32(t+2,!0),16)+e.getUint16(t,!0),Jr=e=>{var t=e.getUint16(0,!0),r=e.getUint16(2,!0),i=e.getUint32(4,!0),n=e.getUint16(8,!0);return{version:r,json_size:i,root_entries:n}},Yt=e=>{let t=new Map;for(var r=0;r<e.byteLength;r+=17){var i=e.getUint8(r,!0),n=i&127,a=i>>7,s=Xt(e,r+1),o=Xt(e,r+4),l=Qr(e,r+7),h=e.getUint32(r+13,!0);t.set(n+"_"+s+"_"+o,[l,h,a])}return t},ve=class{constructor(t){re(this,"metadata",t=>new Promise((r,i)=>{this.root.then(n=>{r(n.metadata)})}));re(this,"getLeaf",(t,r)=>new Promise((i,n)=>{this.leaves.has(t)?(this.leaves.get(t)[0]++,i(this.leaves.get(t)[1])):this.outstanding_requests.has(t)?this.outstanding_requests.get(t).push(i):(this.outstanding_requests.set(t,[]),fetch(this.url,{headers:{Range:"bytes="+t+"-"+(t+r-1)}}).then(a=>a.arrayBuffer()).then(a=>{var s=Yt(new DataView(a),r/17);if(this.leaves.size>32){var o=1/0,l=void 0;this.leaves.forEach((h,d)=>{h[0]<o&&(o=h[0],l=d)}),this.leaves.delete(l)}this.leaves.set(t,[this.step++,s]),i(s),this.outstanding_requests.get(t).forEach(h=>h(s)),this.outstanding_requests.delete(t)}))}));re(this,"getZxy",(t,r,i)=>{var n=t+"_"+r+"_"+i;return this.root.then(a=>{if(a.dir.has(n)&&a.dir.get(n)[2]==0)return a.dir.get(n);if(t>=7){var s=t-7,o=[7,Math.trunc(r/(1<<s)),Math.trunc(i/(1<<s))],l=o[0]+"_"+o[1]+"_"+o[2];if(a.dir.has(l)&&a.dir.get(l)[2]==1){let h=a.dir.get(l);return this.getLeaf(h[0],h[1]).then(d=>d.has(n)?d.get(n):null)}}return null})});re(this,"transformRequest",(t,r,i,n)=>{if(t.endsWith(".pmtiles")&&n){var a=i.tileID.canonical,s=a.z+"_"+a.x+"_"+a.y;this.getZxy(a.z,a.x,a.y).then(o=>{o&&n({url:this.url,headers:{Range:"bytes="+o[0]+"-"+(o[0]+o[1]-1)}})})}return{url:t}});re(this,"leafletLayer",t=>{let r=this;var i=L.GridLayer.extend({createTile:function(n,a){var s=document.createElement("img"),o;return r.getZxy(n.z,n.x,n.y).then(l=>{l!==null&&fetch(r.url,{headers:{Range:"bytes="+l[0]+"-"+(l[0]+l[1]-1)}}).then(h=>h.arrayBuffer()).then(h=>{var d=new Blob([h],{type:"image/png"}),c=window.URL.createObjectURL(d);s.src=c,a(o,s)})}),s},_removeTile:function(n){var a=this._tiles[n];!a||(a.el.width=0,a.el.height=0,a.el.deleted=!0,L.DomUtil.remove(a.el),delete this._tiles[n],this.fire("tileunload",{tile:a.el,coords:this._keyToTileCoords(n)}))}});return new i(t)});this.url=t;let r=new AbortController,i=r.signal;this.root=fetch(this.url,{signal:i,headers:{Range:"bytes=0-511999"}}).then(n=>(n.headers.get("Content-Length")!=512e3&&(console.error("Content-Length mismatch indicates byte serving not supported; aborting."),r.abort()),n.arrayBuffer())).then(n=>{let a=Jr(new DataView(n,0,10));var s=new TextDecoder("utf-8");return{metadata:JSON.parse(s.decode(new DataView(n,10,a.json_size))),dir:Yt(new DataView(n,10+a.json_size,17*a.root_entries))}}),this.step=0,this.leaves=new Map,this.outstanding_requests=new Map}};var $;(function(i){i[i.Point=1]="Point",i[i.Line=2]="Line",i[i.Polygon=3]="Polygon"})($||($={}));function W(e){return e.x+":"+e.y+":"+e.z}var Kr=(e,t,r)=>{e.pos=t;for(var i=e.readVarint()+e.pos,n=1,a=0,s=0,o=0,l=1/0,h=-1/0,d=1/0,c=-1/0,p=[],x;e.pos<i;){if(a<=0){var b=e.readVarint();n=b&7,a=b>>3}if(a--,n===1||n===2)s+=e.readSVarint()*r,o+=e.readSVarint()*r,s<l&&(l=s),s>h&&(h=s),o<d&&(d=o),o>c&&(c=o),n===1&&(x&&p.push(x),x=[]),x.push(new Ae.default(s,o));else if(n===7)x&&x.push(x[0].clone());else throw new Error("unknown command "+n)}return x&&p.push(x),{geom:p,bbox:{minX:l,minY:d,maxX:h,maxY:c}}};function Vt(e,t){let r=new It.VectorTile(new Rt.default(e)),i=new Map;for(let[n,a]of Object.entries(r.layers)){let s=[],o=a;for(let l=0;l<o.length;l++){let h=Kr(o.feature(l)._pbf,o.feature(l)._geometry,t/o.extent),d=0;for(let c of h.geom)d+=c.length;s.push({id:o.feature(l).id,geomType:o.feature(l).type,geom:h.geom,numVertices:d,bbox:h.bbox,props:o.feature(l).properties})}i.set(n,s)}return i}var O=class{constructor(t,r){t.url?this.p=t:this.p=new ve(t),this.controllers=[],this.shouldCancelZooms=r}get(t,r){return D(this,null,function*(){this.shouldCancelZooms&&(this.controllers=this.controllers.filter(s=>s[0]!=t.z?(s[1].abort(),!1):!0));let i=yield this.p.getZxy(t.z,t.x,t.y);if(!i)throw new Error(`Tile ${t.z} ${t.x} ${t.y} not found in archive`);let n=new AbortController;this.controllers.push([t.z,n]);let a=n.signal;return new Promise((s,o)=>{fetch(this.p.url,{headers:{Range:"bytes="+i[0]+"-"+(i[0]+i[1]-1)},signal:a}).then(l=>l.arrayBuffer()).then(l=>{let h=Vt(l,r);s(h)}).catch(l=>{o(l)})})})}},oe=class{constructor(t,r){this.url=t,this.controllers=[],this.shouldCancelZooms=r}get(t,r){return D(this,null,function*(){this.shouldCancelZooms&&(this.controllers=this.controllers.filter(s=>s[0]!=t.z?(s[1].abort(),!1):!0));let i=this.url.replace("{z}",t.z.toString()).replace("{x}",t.x.toString()).replace("{y}",t.y.toString()),n=new AbortController;this.controllers.push([t.z,n]);let a=n.signal;return new Promise((s,o)=>{fetch(i,{signal:a}).then(l=>l.arrayBuffer()).then(l=>{let h=Vt(l,r);s(h)}).catch(l=>{o(l)})})})}},Qe=6378137,At=85.0511287798,Ee=Qe*Math.PI,ei=e=>{let t=Math.PI/180,r=Math.max(Math.min(At,e[0]),-At),i=Math.sin(r*t);return new Ae.default(Qe*e[1]*t,Qe*Math.log((1+i)/(1-i))/2)};function Et(e){return e*e}function qe(e,t){return Et(e.x-t.x)+Et(e.y-t.y)}function ti(e,t,r){var i=qe(t,r);if(i===0)return qe(e,t);var n=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/i;return n=Math.max(0,Math.min(1,n)),qe(e,{x:t.x+n*(r.x-t.x),y:t.y+n*(r.y-t.y)})}function Je(e,t){for(var r=!1,i=0,n=t.length-1;i<t.length;n=i++){var a=t[i].x,s=t[i].y,o=t[n].x,l=t[n].y,h=s>e.y!=l>e.y&&e.x<(o-a)*(e.y-s)/(l-s)+a;h&&(r=!r)}return r}function qt(e){for(var t=0,r=0;r<e.length;r++){let i=(r+1)%e.length;t+=e[r].x*e[i].y,t-=e[i].x*e[r].y}return t<0}function $t(e,t){var r=!1;for(let i of t)if(qt(i))Je(e,i)&&(r=!1);else{if(r)return!0;Je(e,i)&&(r=!0)}return r}function jt(e,t){let r=1/0;for(let i of t){let n=Math.sqrt(qe(e,i[0]));n<r&&(r=n)}return r}function Zt(e,t){let r=1/0;for(let n of t)for(var i=0;i<n.length-1;i++){let a=Math.sqrt(ti(e,n[i],n[i+1]));a<r&&(r=a)}return r}var le=class{constructor(t,r){this.source=t,this.cache=new Map,this.inflight=new Map,this.tileSize=r}queryFeatures(t,r,i,n){let a=ei([r,t]);var s=new Ae.default((a.x+Ee)/(Ee*2),1-(a.y+Ee)/(Ee*2));s.x>1&&(s.x=s.x-Math.floor(s.x));let o=s.mult(1<<i),l=Math.floor(o.x),h=Math.floor(o.y),d=W({z:i,x:l,y:h}),c=[],p=this.cache.get(d);if(p){let x={x:(o.x-l)*this.tileSize,y:(o.y-h)*this.tileSize};for(let[b,w]of p.data.entries())for(let u of w)u.geomType==1?jt(x,u.geom)<n&&c.push({feature:u,layerName:b}):u.geomType==2?Zt(x,u.geom)<n&&c.push({feature:u,layerName:b}):$t(x,u.geom)&&c.push({feature:u,layerName:b})}return c}get(t){return D(this,null,function*(){let r=W(t);return new Promise((i,n)=>{let a=this.cache.get(r);if(a)a.used=performance.now(),i(a.data);else{let s=this.inflight.get(r);s?s.push([i,n]):(this.inflight.set(r,[]),this.source.get(t,this.tileSize).then(o=>{this.cache.set(r,{used:performance.now(),data:o});let l=this.inflight.get(r);if(l&&l.forEach(h=>h[0](o)),this.inflight.delete(r),i(o),this.cache.size>=64){let h=1/0,d;this.cache.forEach((c,p)=>{c.used<h&&(h=c.used,d=p)}),d&&this.cache.delete(d)}}).catch(o=>{let l=this.inflight.get(r);l&&l.forEach(h=>h[1](o)),this.inflight.delete(r),n(o)}))}})})}};var Q=q(U()),he=(e,t,r)=>{let i=[];for(let n of e){let a=[];for(let s of n)a.push(s.clone().mult(t).add(r));i.push(a)}return i},_e=(e,t)=>{let r=1<<t;return e<0&&(e=r+e),e>=r&&(e=e%r),e},ue=class{constructor(t,r,i){this.tileCache=t,this.maxDataLevel=r,this.levelDiff=i}dataTilesForBounds(t,r){let i=Math.pow(2,t)/Math.pow(2,Math.ceil(t)),n=[];var a=1,s=this.tileCache.tileSize;if(t<this.levelDiff)a=1/(1<<this.levelDiff-t)*i,n.push({data_tile:{z:0,x:0,y:0},origin:new Q.default(0,0),scale:a,dim:s*a});else if(t<=this.levelDiff+this.maxDataLevel){let h=1<<this.levelDiff,d=256*i,c=Math.ceil(t)-this.levelDiff,p=Math.floor(r.minX/h/d),x=Math.floor(r.minY/h/d),b=Math.floor(r.maxX/h/d),w=Math.floor(r.maxY/h/d);for(var o=p;o<=b;o++)for(var l=x;l<=w;l++){let u=new Q.default(o*h*d,l*h*d);n.push({data_tile:{z:c,x:_e(o,c),y:_e(l,c)},origin:u,scale:i,dim:s*i})}}else{let h=1<<this.levelDiff;a=(1<<Math.ceil(t)-this.maxDataLevel-this.levelDiff)*i;let d=Math.floor(r.minX/h/256/a),c=Math.floor(r.minY/h/256/a),p=Math.floor(r.maxX/h/256/a),x=Math.floor(r.maxY/h/256/a);for(var o=d;o<=p;o++)for(var l=c;l<=x;l++){let u=new Q.default(o*h*256*a,l*h*256*a);n.push({data_tile:{z:this.maxDataLevel,x:_e(o,this.maxDataLevel),y:_e(l,this.maxDataLevel)},origin:u,scale:a,dim:s*a})}}return n}dataTileForDisplayTile(t){var r,i=1,n=this.tileCache.tileSize,a;if(t.z<this.levelDiff)r={z:0,x:0,y:0},i=1/(1<<this.levelDiff-t.z),a=new Q.default(0,0),n=n*i;else if(t.z<=this.levelDiff+this.maxDataLevel){let s=1<<this.levelDiff;r={z:t.z-this.levelDiff,x:Math.floor(t.x/s),y:Math.floor(t.y/s)},a=new Q.default(r.x*s*256,r.y*s*256)}else{i=1<<t.z-this.maxDataLevel-this.levelDiff;let s=1<<this.levelDiff;r={z:this.maxDataLevel,x:Math.floor(t.x/s/i),y:Math.floor(t.y/s/i)},a=new Q.default(r.x*s*i*256,r.y*s*i*256),n=n*i}return{data_tile:r,scale:i,origin:a,dim:n}}getBbox(t,r){return D(this,null,function*(){let i=this.dataTilesForBounds(t,r);return(yield Promise.all(i.map(a=>this.tileCache.get(a.data_tile)))).map((a,s)=>{let o=i[s];return{data:a,z:t,data_tile:o.data_tile,scale:o.scale,dim:o.dim,origin:o.origin}})})}getDisplayTile(t){return D(this,null,function*(){let r=this.dataTileForDisplayTile(t);return{data:yield this.tileCache.get(r.data_tile),z:t.z,data_tile:r.data_tile,scale:r.scale,origin:r.origin,dim:r.dim}})}queryFeatures(t,r,i){let n=Math.min(i-this.levelDiff,this.maxDataLevel),a=16/(1<<i-n);return this.tileCache.queryFeatures(t,r,n,a)}};var at=q(U());var Y=q(U());var Kt=q(Wt());var I=class{constructor(t,r="black"){this.color=t||r,this.per_feature=typeof this.color=="function"&&this.color.length==2}get(t,r){return typeof this.color=="function"?this.color(t,r):this.color}},X=class{constructor(t,r=1){this.value=t||r,this.per_feature=typeof this.value=="function"&&this.value.length==2}get(t,r){return typeof this.value=="function"?this.value(t,r):this.value}},Fe=class{constructor(t={}){this.label_props=t.label_props||["name"],this.textTransform=t.textTransform}get(t,r){var i;for(let n of this.label_props)if(r.props.hasOwnProperty(n)){i=r.props[n];break}return i&&this.textTransform==="uppercase"&&(i=i.toUpperCase()),i}},ze=class{constructor(t){t.font?this.font=t.font:(this.family=t.fontFamily||"sans-serif",this.size=t.fontSize||12,this.weight=t.fontWeight,this.style=t.fontStyle)}get(t,r){if(this.font)return typeof this.font=="function"?this.font(t,r):this.font;var i="";this.style&&(typeof this.style=="function"?i=this.style(t,r)+" ":i=this.style+" ");var n="";this.weight&&(typeof this.weight=="function"?n=this.weight(t,r)+" ":n=this.weight+" ");var a;typeof this.size=="function"?a=this.size(t,r):a=this.size;var s;return typeof this.family=="function"?s=this.family(t,r):s=this.family,`${i}${n}${a}px ${s}`}};function rt(e,t){if(e.length<=t)return[e];let r=t-1,i=e.lastIndexOf(" ",r),n=e.indexOf(" ",r);if(i==-1&&n==-1)return[e];let a,s;return n==-1||i>=0&&r-i<n-r?(a=e.substring(0,i),s=e.substring(i+1,e.length)):(a=e.substring(0,n),s=e.substring(n+1,e.length)),[a,...rt(s,t)]}var si="\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3220-\u3229\u3248-\u324F\u3251-\u325F\u3280-\u3289\u32B1-\u32BF\u3400-\u4DB5\u4E00-\u9FEA\uF900-\uFA6D\uFA70-\uFAD9\u2000",$i=new RegExp("^["+si+"]+$");var Gt=q(Ht());function Qt(e,t){let r,i,n=0;for(let a of e){let s=(0,Gt.default)(a,Math.PI/2/18);for(let o of s)o.length>=t&&o.length>n&&(n=o.length,r=a[o.beginIndex],i=a[o.endIndex-1])}if(!!r&&!(r.x==i.x&&r.y==i.y))return{start:r,end:i}}function Jt(e,t,r,i){let n=t.x-e.x,a=t.y-e.y,s=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)),o=[];for(var l=i;l<r;l+=2*i){let h=l*1/s;o.push({x:e.x+h*n,y:e.y+h*a})}return o}var oi=(e,t,r)=>{let i=document.createElement("canvas"),n=i.getContext("2d");return i.width=e,i.height=t,r(i,n),i},P=class{constructor(t){this.pattern=t.pattern,this.fill=new I(t.fill),this.opacity=new X(t.opacity,1),this.per_feature=this.fill.per_feature||this.opacity.per_feature||t.per_feature}before(t,r){this.per_feature||(t.globalAlpha=this.opacity.get(r),t.fillStyle=this.fill.get(r)),this.pattern&&(t.fillStyle=t.createPattern(this.pattern,"repeat"))}draw(t,r,i,n){this.per_feature&&(t.fillStyle=this.fill.get(i,n),t.globalAlpha=this.opacity.get(i,n)),t.beginPath();for(var a of r)for(var s=0;s<a.length-1;s++){let o=a[s];s==0?t.moveTo(o.x,o.y):t.lineTo(o.x,o.y)}t.fill()}};function li(e,t){return r=>{let i=r-e;return i>=0&&i<t.length?t[i]:0}}function R(e,t){return r=>{if(r<=t[0][0])return t[0][1];if(r>=t[t.length-1][0])return t[t.length-1][1];let i=0;for(;t[i+1][0]<r;)i++;let n=t[i+1][0]-t[i][0],a=r-t[i][0];var s;return n===0?s=0:e===1?s=a/n:s=(Math.pow(e,a)-1)/(Math.pow(e,n)-1),s*(t[i+1][1]-t[i][1])+t[i][1]}}var B=class{constructor(t){this.color=new I(t.color),this.width=new X(t.width),this.opacity=new X(t.opacity),this.dash=t.dash,this.dashColor=new I(t.dashColor),this.dashWidth=new X(t.dashWidth),this.skip=!1,this.per_feature=this.dash||this.color.per_feature||this.opacity.per_feature||this.width.per_feature||t.per_feature}before(t,r){this.per_feature||(t.strokeStyle=this.color.get(r),t.lineWidth=this.width.get(r),t.globalAlpha=this.opacity.get(r))}draw(t,r,i,n){if(!this.skip){t.beginPath();for(var a of r)for(var s=0;s<a.length;s++){let o=a[s];s==0?t.moveTo(o.x,o.y):t.lineTo(o.x,o.y)}this.per_feature&&(t.globalAlpha=this.opacity.get(i,n)),this.dash?(t.save(),this.per_feature&&(t.lineWidth=this.dashWidth.get(i,n),t.strokeStyle=this.dashColor.get(i,n)),t.setLineDash(this.dash),t.stroke(),t.restore()):(this.per_feature&&(t.lineWidth=this.width.get(i,n),t.strokeStyle=this.color.get(i,n)),t.stroke())}}},er=class{constructor(t){this.sprites=t.sprites,this.name=t.name}place(t,r,i){let n=r[0],a=new Y.default(r[0][0].x,r[0][0].y),s={minX:a.x-32,minY:a.y-32,maxX:a.x+32,maxY:a.y+32};return[{anchor:a,bboxes:[s],draw:l=>{l.globalAlpha=1;let h=this.sprites.get(this.name);l.drawImage(h.canvas,h.x,h.y,h.w,h.h,-8,-8,h.w,h.h)}}]}},N=class{constructor(t){this.radius=new X(t.radius,3),this.fill=new I(t.fill),this.stroke=new I(t.stroke,"white"),this.width=new X(t.width,0),this.opacity=new X(t.opacity)}draw(t,r,i,n){t.globalAlpha=this.opacity.get(i,n);let a=this.radius.get(i,n),s=this.width.get(i,n);s>0&&(t.fillStyle=this.stroke.get(i,n),t.beginPath(),t.arc(r[0][0].x,r[0][0].y,a+s,0,2*Math.PI),t.fill()),t.fillStyle=this.fill.get(i,n),t.beginPath(),t.arc(r[0][0].x,r[0][0].y,a,0,2*Math.PI),t.fill()}place(t,r,i){let n=r[0],a=new Y.default(r[0][0].x,r[0][0].y),s=this.radius.get(t.zoom,i),o={minX:a.x-s,minY:a.y-s,maxX:a.x+s,maxY:a.y+s};return[{anchor:a,bboxes:[o],draw:h=>{this.draw(h,[[new Y.default(0,0)]],t.zoom,i)}}]}},je=class{constructor(t){this.font=new ze(t),this.text=new Fe(t),this.fill=new I(t.fill),this.background=new I(t.background,"white"),this.padding=new X(t.padding,0)}place(t,r,i){let n=this.text.get(t.zoom,i);if(!n)return;let a=this.font.get(t.zoom,i);t.scratch.font=a;let s=t.scratch.measureText(n),o=s.width,l=s.actualBoundingBoxAscent,h=s.actualBoundingBoxDescent,d=r[0],c=new Y.default(r[0][0].x,r[0][0].y),p=this.padding.get(t.zoom,i),x={minX:c.x-o/2-p,minY:c.y-l-p,maxX:c.x+o/2+p,maxY:c.y+h+p};return[{anchor:c,bboxes:[x],draw:w=>{w.globalAlpha=1,w.fillStyle=this.background.get(t.zoom,i),w.fillRect(-o/2-p,-l-p,o+2*p,l+h+2*p),w.fillStyle=this.fill.get(t.zoom,i),w.font=a,w.fillText(n,-o/2,0)}}]}},Le=class{constructor(t,r){this.list=t}place(t,r,i){var n=this.list[0].place(t,r,i);if(!n)return;var a=n[0];let s=a.anchor,o=a.bboxes[0],l=o.maxY-o.minY,h=[{draw:a.draw,translate:{x:0,y:0}}],d=[[{x:r[0][0].x,y:r[0][0].y+l}]];for(let p=1;p<this.list.length;p++)n=this.list[p].place(t,d,i),n&&(a=n[0],o=tr(o,a.bboxes[0]),h.push({draw:a.draw,translate:{x:0,y:l}}));return[{anchor:s,bboxes:[o],draw:p=>{for(let x of h)p.save(),p.translate(x.translate.x,x.translate.y),x.draw(p),p.restore()}}]}},tr=(e,t)=>({minX:Math.min(e.minX,t.minX),minY:Math.min(e.minY,t.minY),maxX:Math.max(e.maxX,t.maxX),maxY:Math.max(e.maxY,t.maxY)}),Me=class{constructor(t){this.list=t}place(t,r,i){let n=this.list[0];if(!n)return;var a=n.place(t,r,i);if(!a)return;var s=a[0];let o=s.anchor,l=s.bboxes[0],h=[s.draw];for(let c=1;c<this.list.length;c++){if(a=this.list[c].place(t,r,i),!a)return;s=a[0],l=tr(l,s.bboxes[0]),h.push(s.draw)}return[{anchor:o,bboxes:[l],draw:c=>{h.forEach(p=>p(c))}}]}},it=class{constructor(t){this.symbolizer=t}place(t,r,i){let n=r[0][0],a=this.symbolizer.place(t,[[new Y.default(0,0)]],i);if(!a||a.length==0)return;let s=a[0],o=s.bboxes[0],l=o.maxX-o.minX,h=o.maxY-o.minY,d={minX:n.x-l/2,maxX:n.x+l/2,minY:n.y-h/2,maxY:n.y+h/2};return[{anchor:n,bboxes:[d],draw:p=>{p.translate(-l/2,h/2-o.maxY),s.draw(p)}}]}},ke=class{constructor(t){this.font=new ze(t),this.text=new Fe(t),this.fill=new I(t.fill),this.stroke=new I(t.stroke),this.width=new X(t.width,0),this.maxLineCodeUnits=t.maxLineChars||15}place(t,r,i){let n=this.text.get(t.zoom,i);if(!n)return;let a=this.font.get(t.zoom,i);t.scratch.font=a;let s=rt(n,this.maxLineCodeUnits);var o,l=0;for(let f of s)f.length>l&&(l=f.length,o=f);let h=t.scratch.measureText(o),d=h.width,c=h.actualBoundingBoxAscent,p=h.actualBoundingBoxDescent,x=c+p,b=new Y.default(r[0][0].x,r[0][0].y),w={minX:b.x,minY:b.y-c,maxX:b.x+d,maxY:b.y+p+(s.length-1)*x};return[{anchor:b,bboxes:[w],draw:f=>{f.globalAlpha=1,f.font=a,f.fillStyle=this.fill.get(t.zoom,i);let m=this.width.get(t.zoom,i);var g=0;for(let y of s)m&&(f.lineWidth=m*2,f.strokeStyle=this.stroke.get(t.zoom,i),f.strokeText(y,0,g)),f.fillText(y,0,g),g+=x}}]}},j=class{constructor(t){this.centered=new it(new ke(t))}place(t,r,i){return this.centered.place(t,r,i)}},nt=class{constructor(t,r){this.symbolizer=t,this.offset=new X(r.offset,0)}place(t,r,i){if(i.geomType!==$.Point)return;let n=r[0][0],a=this.symbolizer.place(t,[[new Y.default(0,0)]],i);if(!a||a.length==0)return;let s=a[0],o=s.bboxes[0],l=this.offset.get(t.zoom,i),h=(x,b)=>({minX:x.x+b.x+o.minX,minY:x.y+b.y+o.minY,maxX:x.x+b.x+o.maxX,maxY:x.y+b.y+o.maxY});var d=new Y.default(l,-l);let c=x=>{x.translate(d.x,d.y),s.draw(x)};var p=h(n,d);if(!t.index.bboxCollides(p,t.order))return[{anchor:n,bboxes:[p],draw:c}];if(d=new Y.default(-l-o.maxX,l-o.minY),p=h(n,d),!t.index.bboxCollides(p,t.order))return[{anchor:n,bboxes:[p],draw:c}];if(d=new Y.default(-l-o.maxX,-l),p=h(n,d),!t.index.bboxCollides(p,t.order))return[{anchor:n,bboxes:[p],draw:c}];if(d=new Y.default(-l-o.maxX,l-o.minY),p=h(n,d),!t.index.bboxCollides(p,t.order))return[{anchor:n,bboxes:[p],draw:c}]}},J=class{constructor(t){this.symbolizer=new nt(new ke(t),t)}place(t,r,i){return this.symbolizer.place(t,r,i)}},fe=class{constructor(t){this.font=new ze(t),this.text=new Fe(t),this.fill=new I(t.fill),this.stroke=new I(t.stroke),this.width=new X(t.width,0),this.offset=new X(t.offset,0)}place(t,r,i){let n=this.text.get(t.zoom,i);if(!n||n.length>20)return;let a=i.bbox;if((a.maxY-a.minY)*(a.maxX-a.minX)<400)return;let o=this.font.get(t.zoom,i);t.scratch.font=o;let h=t.scratch.measureText(n).width,d=Qt(r,h);if(!d)return;let c=d.end.x-d.start.x,p=d.end.y-d.start.y,x=8,w=Jt(d.start,d.end,h,8).map(f=>({minX:f.x-x,minY:f.y-x,maxX:f.x+x,maxY:f.y+x})),u=f=>{f.globalAlpha=1,f.rotate(Math.atan2(p,c)),c<0&&(f.scale(-1,-1),f.translate(-h,0)),f.translate(0,-this.offset.get(t.zoom,i)),f.font=o;let m=this.width.get(t.zoom,i);m&&(f.lineWidth=m,f.strokeStyle=this.stroke.get(t.zoom,i),f.strokeText(n,0,0)),f.fillStyle=this.fill.get(t.zoom,i),f.fillText(n,0,0)};return[{anchor:d.start,bboxes:w,draw:u}]}},de=class{constructor(t){this.symbolizer=new ke(t)}place(t,r,i){let n=i.bbox;if((n.maxY-n.minY)*(n.maxX-n.minX)<2e4)return;let s=this.symbolizer.place(t,[[new Y.default(0,0)]],i);if(!s||s.length==0)return;let o=s[0],l=o.bboxes[0],h=r[0],d=(0,Kt.default)([h.map(b=>[b.x,b.y])]),c=new Y.default(d[0],d[1]),p={minX:c.x-(l.maxX-l.minX)/2,minY:c.y-(l.maxY-l.minY)/2,maxX:c.x+(l.maxX-l.minX)/2,maxY:c.y+(l.maxY-l.minY)/2};return[{anchor:c,bboxes:[p],draw:b=>{b.translate(o.anchor.x-(l.maxX-l.minX)/2,o.anchor.y),o.draw(b)}}]}};function st(e,t,r,i,n,a){let s=performance.now(),o=["crimson","lightgreen","lightseagreen","mediumslateblue","purple","cornflowerblue"];e.save(),e.miterLimit=2;for(var l of t){let h=l.origin,d=l.scale,c=l.dim;if(e.save(),n){e.beginPath();let p=Math.max(h.x-i.x,r.minX-i.x)-.5,x=Math.max(h.y-i.y,r.minY-i.y)-.5,b=Math.min(h.x-i.x+c,r.maxX-i.x)+.5,w=Math.min(h.y-i.y+c,r.maxY-i.y)+.5;e.rect(p,x,b-p,w-x),e.clip()}e.translate(h.x-i.x,h.y-i.y),n&&(e.translate(c/2,c/2),e.scale(1+1/c,1+1/c),e.translate(-c/2,-c/2)),l.data.forEach((p,x)=>{if(x=="earth")return;let b=o[x.charCodeAt(0)%6],w=new N({fill:b,opacity:.8}),u=new B({per_feature:!0,color:b,opacity:.5}),f=new P({per_feature:!0,fill:b,opacity:.3});u.before(e,l.z),f.before(e,l.z);for(var m of p){let g=m.geom,y=m.bbox;y.maxX*d+h.x<r.minX||y.minX*d+h.x>r.maxX||y.minY*d+h.y>r.maxY||y.maxY*d+h.y<r.minY||(d!=1&&(g=he(g,d,new at.default(0,0))),m.geomType==$.Point?w.draw(e,g,l.z,m):(m.geomType==$.Line||f.draw(e,g,l.z,m),u.draw(e,g,l.z,m)))}}),e.restore()}return n&&(e.beginPath(),e.rect(r.minX-i.x,r.minY-i.y,r.maxX-r.minX,r.maxY-r.minY),e.clip()),e.restore(),performance.now()-s}function Se(e,t,r,i,n,a,s,o){let l=performance.now();e.save(),e.miterLimit=2;for(var h of t){let b=h.origin,w=h.scale,u=h.dim;if(e.save(),s){e.beginPath();let f=Math.max(b.x-a.x,n.minX-a.x)-.5,m=Math.max(b.y-a.y,n.minY-a.y)-.5,g=Math.min(b.x-a.x+u,n.maxX-a.x)+.5,y=Math.min(b.y-a.y+u,n.maxY-a.y)+.5;e.rect(f,m,g-f,y-m),e.clip()}e.translate(b.x-a.x,b.y-a.y),s&&(e.translate(u/2,u/2),e.scale(1+1/u,1+1/u),e.translate(-u/2,-u/2));for(var d of i)if(!(d.minzoom&&h.z<d.minzoom)&&!(d.maxzoom&&h.z>d.maxzoom)){var c=h.data.get(d.dataLayer);if(c!==void 0){d.symbolizer.before&&d.symbolizer.before(e,h.z);for(var p of c){let f=p.geom,m=p.bbox;m.maxX*w+b.x<n.minX||m.minX*w+b.x>n.maxX||m.minY*w+b.y>n.maxY||m.maxY*w+b.y<n.minY||d.filter&&!d.filter(h.z,p)||(w!=1&&(f=he(f,w,new at.default(0,0))),d.symbolizer.draw(e,f,h.z,p))}}}e.restore()}if(s&&(e.beginPath(),e.rect(n.minX-a.x,n.minY-a.y,n.maxX-n.minX,n.maxY-n.minY),e.clip()),r){let b=r.searchBbox(n,1/0);for(var x of b)if(e.save(),e.translate(x.anchor.x-a.x,x.anchor.y-a.y),x.draw(e),e.restore(),o){e.lineWidth=.5,e.strokeStyle=o,e.fillStyle=o,e.globalAlpha=1,e.fillRect(x.anchor.x-a.x-2,x.anchor.y-a.y-2,4,4);for(let w of x.bboxes)e.strokeRect(w.minX-a.x,w.minY-a.y,w.maxX-w.minX,w.maxY-w.minY)}}return e.restore(),performance.now()-l}var ir=q(rr()),nr=(e,t,r)=>{let i=256,n=t/i,a=Math.floor(r.minX/i),s=Math.floor(r.minY/i),o=Math.floor(r.maxX/i),l=Math.floor(r.maxY/i),h=Math.log2(n),d=[];for(let c=a;c<=o;c++)for(let p=s;p<=l;p++)d.push({display:W({z:e,x:c,y:p}),key:W({z:e-h,x:Math.floor(c/n),y:Math.floor(p/n)})});return d},ht=class{constructor(){this.tree=new ir.default,this.current=new Map}has(t){return this.current.has(t)}size(){return this.current.size}keys(){return this.current.keys()}searchBbox(t,r){let i=new Set;for(let n of this.tree.search(t))n.indexed_label.order<=r&&i.add(n.indexed_label);return i}searchLabel(t,r){let i=new Set;for(let n of t.bboxes)for(let a of this.tree.search(n))a.indexed_label.order<=r&&i.add(a.indexed_label);return i}bboxCollides(t,r){for(let i of this.tree.search(t))if(i.indexed_label.order<=r)return!0;return!1}labelCollides(t,r){for(let i of t.bboxes)for(let n of this.tree.search(i))if(n.indexed_label.order<=r)return!0;return!1}insert(t,r,i){let n={anchor:t.anchor,bboxes:t.bboxes,draw:t.draw,order:r,tileKey:i},a=this.current.get(i);if(a)a.add(n);else{let o=new Set;o.add(n),this.current.set(i,o)}for(let o of t.bboxes){var s=o;s.indexed_label=n,this.tree.insert(s)}}prune(t){let r=this.current.get(t);if(!r)return;let i=[];for(let n of this.tree.all())r.has(n.indexed_label)&&i.push(n);i.forEach(n=>{this.tree.remove(n)}),this.current.delete(t)}removeLabel(t){let r=[];for(let n of this.tree.all())t==n.indexed_label&&r.push(n);r.forEach(n=>{this.tree.remove(n)});let i=this.current.get(t.tileKey);i&&i.delete(t)}},Pe=class{constructor(t,r,i,n){this.index=new ht,this.z=t,this.scratch=r,this.labelRules=i,this.callback=n}layout(t){let r=performance.now(),i=W(t.data_tile),n=new Set;for(let[s,o]of this.labelRules.entries()){if(o.visible==!1||o.minzoom&&this.z<o.minzoom||o.maxzoom&&this.z>o.maxzoom)continue;let l=t.data.get(o.dataLayer);if(l===void 0)continue;let h=l;o.sort&&h.sort((c,p)=>o.sort?o.sort(c.props,p.props):0);let d={index:this.index,zoom:this.z,scratch:this.scratch,order:s};for(let c of h){if(o.filter&&!o.filter(this.z,c))continue;let p=he(c.geom,t.scale,t.origin),x=o.symbolizer.place(d,p,c);if(!!x)for(let b of x){var a=!1;if(this.index.labelCollides(b,1/0)){if(!this.index.labelCollides(b,s)){let w=this.index.searchLabel(b,1/0);for(let u of w){this.index.removeLabel(u);for(let f of u.bboxes)this.findInvalidatedTiles(n,t.dim,f,i)}this.index.insert(b,s,i),a=!0}}else this.index.insert(b,s,i),a=!0;if(a)for(let w of b.bboxes)(w.maxX>t.origin.x+t.dim||w.minX<t.origin.x||w.minY<t.origin.y||w.maxY>t.origin.y+t.dim)&&this.findInvalidatedTiles(n,t.dim,w,i)}}}return n.size>0&&this.callback&&this.callback(n),performance.now()-r}findInvalidatedTiles(t,r,i,n){let a=nr(this.z,r,i);for(let s of a)s.key!=n&&this.index.has(s.key)&&t.add(s.display)}pruneCache(t){if(this.index.size()>16){let r,i=0;for(let n of this.index.keys()){let a=n.split(":"),s=Math.sqrt(Math.pow(+a[0]-t.data_tile.x,2)+Math.pow(+a[1]-t.data_tile.y,2));s>i&&(i=s,r=n)}r&&this.index.prune(r)}}add(t){let r=W(t.data_tile);if(this.index.has(r))return 0;{let i=this.layout(t);return this.pruneCache(t),i}}},Ce=class{constructor(t,r,i){this.labelers=new Map,this.scratch=t,this.labelRules=r,this.callback=i}add(t){var r=this.labelers.get(t.z);return r||(r=new Pe(t.z,this.scratch,this.labelRules,this.callback),this.labelers.set(t.z,r)),r.add(t)}getIndex(t){let r=this.labelers.get(t);if(r)return r.index}};var me={earth:"#FFFBF6",glacier:"#ffffff",residential:"#F4F4F8",hospital:"#FFF6F6",cemetery:"#EFF2EE",school:"#F7F6FF",industrial:"#FFF9EF",wood:"#F4F9EF",grass:"#EBF9E3",park:"#E5F9D5",water:"#B7DFF2",sand:"#ebebeb",buildings:"#F2EDE8",highwayCasing:"#FFC3C3",majorRoadCasing:"#FFB9B9",mediumRoadCasing:"#FFCE8E",minorRoadCasing:"#cccccc",highway:"#FFCEBB",majorRoad:"#FFE4B3",mediumRoad:"#FFF2C8",minorRoad:"#ffffff",boundaries:"#9e9e9e",mask:"#dddddd",countryLabel:"#aaaaaa",cityLabel:"#6C6C6C",stateLabel:"#999999",neighbourhoodLabel:"#888888",landuseLabel:"#898989",waterLabel:"#41ABDC",naturalLabel:"#4B8F14",roadsLabel:"#888888",poisLabel:"#606060"};var ce={earth:"#151515",glacier:"#1c1c1c",residential:"#252B2F",hospital:"#3E2C2C",cemetery:"#36483D",school:"#2C3440",industrial:"#33312C",wood:"#3A3E38",grass:"#4E604D",park:"#2C4034",water:"#4D5B73",sand:"#777777",buildings:"#464545",highwayCasing:"#000000",majorRoadCasing:"#1C1B1B",mediumRoadCasing:"#3E3E3E",minorRoadCasing:"#000000",highway:"#5B5B5B",majorRoad:"#595959",mediumRoad:"#4F4F4F",minorRoad:"#393939",boundaries:"#666666",mask:"#dddddd",countryLabel:"#ffffff",cityLabel:"#FFFFFF",stateLabel:"#ffffff",neighbourhoodLabel:"#FDFDFD",landuseLabel:"#DDDDDD",waterLabel:"#707E95",naturalLabel:"#4c4c4c",roadsLabel:"#C4C4C4",poisLabel:"#959393"};function Te(e,t,r){return Math.min(Math.max(e,r),t)}var pe=class extends Error{constructor(t){super(`Failed to parse color: "${t}"`)}};function hi(e){if(typeof e!="string")throw new pe(e);if(e.trim().toLowerCase()==="transparent")return[0,0,0,0];let t=e.trim();t=pi.test(e)?function(s){let o=s.toLowerCase().trim(),l=ui[function(h){let d=5381,c=h.length;for(;c;)d=33*d^h.charCodeAt(--c);return(d>>>0)%2341}(o)];if(!l)throw new pe(s);return`#${l}`}(e):e;let r=fi.exec(t);if(r){let s=Array.from(r).slice(1);return[...s.slice(0,3).map(o=>parseInt(Be(o,2),16)),parseInt(Be(s[3]||"f",2),16)/255]}let i=di.exec(t);if(i){let s=Array.from(i).slice(1);return[...s.slice(0,3).map(o=>parseInt(o,16)),parseInt(s[3]||"ff",16)/255]}let n=mi.exec(t);if(n){let s=Array.from(n).slice(1);return[...s.slice(0,3).map(o=>parseInt(o,10)),parseFloat(s[3]||"1")]}let a=ci.exec(t);if(a){let[s,o,l,h]=Array.from(a).slice(1).map(parseFloat);if(Te(0,100,o)!==o)throw new pe(e);if(Te(0,100,l)!==l)throw new pe(e);return[...xi(s,o,l),h||1]}throw new pe(e)}var ar=e=>parseInt(e.replace(/_/g,""),36),ui="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((e,t)=>{let r=ar(t.substring(0,3)),i=ar(t.substring(3)).toString(16),n="";for(let a=0;a<6-i.length;a++)n+="0";return e[r]=`${n}${i}`,e},{}),Be=(e,t)=>Array.from(Array(t)).map(()=>e).join(""),fi=new RegExp(`^#${Be("([a-f0-9])",3)}([a-f0-9])?$`,"i"),di=new RegExp(`^#${Be("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),mi=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${Be(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),ci=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,pi=/^[a-z]+$/i,sr=e=>Math.round(255*e),xi=(e,t,r)=>{let i=r/100;if(t===0)return[i,i,i].map(sr);let n=(e%360+360)%360/60,a=(1-Math.abs(2*i-1))*(t/100),s=a*(1-Math.abs(n%2-1)),o=0,l=0,h=0;n>=0&&n<1?(o=a,l=s):n>=1&&n<2?(o=s,l=a):n>=2&&n<3?(l=a,h=s):n>=3&&n<4?(l=s,h=a):n>=4&&n<5?(o=s,h=a):n>=5&&n<6&&(o=a,h=s);let d=i-a/2;return[o+d,l+d,h+d].map(sr)};function ut(e){let[t,r,i,n]=hi(e).map((h,d)=>d===3?h:h/255),a=Math.max(t,r,i),s=Math.min(t,r,i),o=(a+s)/2;if(a===s)return[0,0,o,n];let l=a-s;return[60*(t===a?(r-i)/l+(r<i?6:0):r===a?(i-t)/l+2:(t-r)/l+4),o>.5?l/(2-a-s):l/(a+s),o,n]}function or(e,t,r,i){return`hsla(${(e%360).toFixed()}, ${Te(0,100,100*t).toFixed()}%, ${Te(0,100,100*r).toFixed()}%, ${parseFloat(Te(0,1,i).toFixed(3))})`}var lr=(e,t)=>{let r=ut(t),i=yt({},e);for(let[n,a]of Object.entries(e)){let s=ut(a);i[n]=or(r[0],r[1],s[2],s[3])}return i},xe=(e,t)=>(t&&(e=lr(e,t)),[{dataLayer:"earth",symbolizer:new P({fill:e.earth})},{dataLayer:"natural",symbolizer:new P({fill:e.glacier}),filter:(r,i)=>i.props.natural=="glacier"},{dataLayer:"landuse",symbolizer:new P({fill:e.residential}),filter:(r,i)=>i.props.landuse=="residential"||i.props.place=="neighbourhood"},{dataLayer:"landuse",symbolizer:new P({fill:e.hospital}),filter:(r,i)=>i.props.amenity=="hospital"},{dataLayer:"landuse",symbolizer:new P({fill:e.cemetery}),filter:(r,i)=>i.props.landuse=="cemetery"},{dataLayer:"landuse",symbolizer:new P({fill:e.school}),filter:(r,i)=>i.props.amenity=="school"||i.props.amenity=="kindergarten"||i.props.amenity=="university"||i.props.amenity=="college"},{dataLayer:"landuse",symbolizer:new P({fill:e.industrial}),filter:(r,i)=>i.props.landuse=="industrial"},{dataLayer:"natural",symbolizer:new P({fill:e.wood}),filter:(r,i)=>i.props.natural=="wood"},{dataLayer:"landuse",symbolizer:new P({fill:e.grass}),filter:(r,i)=>i.props.landuse=="grass"},{dataLayer:"landuse",symbolizer:new P({fill:e.park}),filter:(r,i)=>i.props.leisure=="park"},{dataLayer:"water",symbolizer:new P({fill:e.water})},{dataLayer:"natural",symbolizer:new P({fill:e.sand}),filter:(r,i)=>i.props.natural=="sand"},{dataLayer:"buildings",symbolizer:new P({fill:e.buildings})},{dataLayer:"roads",symbolizer:new B({color:e.highwayCasing,width:R(1.4,[[5,1.5],[11,4],[16,9],[20,40]])}),filter:(r,i)=>i.props["pmap:kind"]=="highway"},{dataLayer:"roads",symbolizer:new B({color:e.majorRoadCasing,width:R(1.4,[[9,3],[12,4],[17,8],[20,22]])}),filter:(r,i)=>i.props["pmap:kind"]=="major_road"},{dataLayer:"roads",symbolizer:new B({color:e.mediumRoadCasing,width:R(1.4,[[13,3],[17,6],[20,18]])}),filter:(r,i)=>i.props["pmap:kind"]=="medium_road"},{dataLayer:"roads",symbolizer:new B({color:e.minorRoadCasing,width:R(1.4,[[14,2],[17,5],[20,15]])}),filter:(r,i)=>i.props["pmap:kind"]=="minor_road"},{dataLayer:"roads",symbolizer:new B({color:e.minorRoad,width:R(1.4,[[14,1],[17,3],[20,13]])}),filter:(r,i)=>i.props["pmap:kind"]=="minor_road"},{dataLayer:"roads",symbolizer:new B({color:e.mediumRoad,width:R(1.4,[[13,2],[17,4],[20,15]])}),filter:(r,i)=>i.props["pmap:kind"]=="medium_road"},{dataLayer:"roads",symbolizer:new B({color:e.majorRoad,width:R(1.4,[[9,2],[12,3],[17,6],[20,20]])}),filter:(r,i)=>i.props["pmap:kind"]=="major_road"},{dataLayer:"roads",symbolizer:new B({color:e.highway,width:R(1.4,[[5,.5],[11,2.5],[16,7],[20,30]])}),filter:(r,i)=>i.props["pmap:kind"]=="highway"},{dataLayer:"boundaries",symbolizer:new B({color:e.boundaries,width:2,opacity:.4})},{dataLayer:"mask",symbolizer:new P({fill:e.mask})}]),ye=(e,t,r,i)=>{t&&(e=lr(e,t));var n=["name"];r&&(n=r);let a=(s,o)=>i?s instanceof J?new Le([s,new J({fill:o,label_props:i})],{}):new Le([s,new j({fill:o,label_props:i})],{}):s;return[{dataLayer:"places",symbolizer:a(new j({label_props:n,fill:e.countryLabel,font:(s,o)=>s<6?"200 14px sans-serif":"200 20px sans-serif",textTransform:"uppercase"}),e.countryLabel),filter:(s,o)=>o.props["pmap:kind"]=="country"},{dataLayer:"places",symbolizer:a(new j({label_props:n,fill:e.stateLabel,font:"300 16px sans-serif"}),e.stateLabel),filter:(s,o)=>o.props["pmap:kind"]=="state"},{id:"cities_high",dataLayer:"places",filter:(s,o)=>o.props["pmap:kind"]=="city",minzoom:7,symbolizer:a(new j({label_props:n,fill:e.cityLabel,font:(s,o)=>o.props["pmap:rank"]==1?s>8?"600 20px sans-serif":"600 12px sans-serif":s>8?"600 16px sans-serif":"600 10px sans-serif"}),e.cityLabel),sort:(s,o)=>s["pmap:rank"]-o["pmap:rank"]},{id:"cities_low",dataLayer:"places",filter:(s,o)=>o.props["pmap:kind"]=="city",maxzoom:6,symbolizer:new Me([new N({radius:2,fill:e.cityLabel}),a(new J({label_props:n,fill:e.cityLabel,offset:2,font:(s,o)=>o.props["pmap:rank"]==1?s>8?"600 20px sans-serif":"600 12px sans-serif":s>8?"600 16px sans-serif":"600 10px sans-serif"}),e.cityLabel)]),sort:(s,o)=>s["pmap:rank"]-o["pmap:rank"]},{id:"neighbourhood",dataLayer:"places",symbolizer:a(new j({label_props:n,fill:e.neighbourhoodLabel,font:"500 10px sans-serif",textTransform:"uppercase"}),e.neighbourhoodLabel),filter:(s,o)=>o.props["pmap:kind"]=="neighbourhood"},{dataLayer:"landuse",symbolizer:a(new de({label_props:n,fill:e.landuseLabel,font:"300 12px sans-serif"}),e.landuseLabel)},{dataLayer:"water",symbolizer:a(new de({label_props:n,fill:e.waterLabel,font:"italic 600 12px sans-serif"}),e.waterLabel)},{dataLayer:"natural",symbolizer:a(new de({label_props:n,fill:e.naturalLabel,font:"italic 300 12px sans-serif"}),e.naturalLabel)},{dataLayer:"roads",symbolizer:a(new fe({label_props:n,fill:e.roadsLabel,font:"500 12px sans-serif"}),e.roadsLabel),minzoom:12},{dataLayer:"roads",symbolizer:new je({label_props:["ref"],font:"600 9px sans-serif",background:e.highway,padding:2,fill:e.neighbourhoodLabel}),filter:(s,o)=>o.props["pmap:kind"]=="highway"},{dataLayer:"pois",symbolizer:new Me([new N({radius:2,fill:e.poisLabel}),a(new J({label_props:n,fill:e.poisLabel,offset:2,font:"300 10px sans-serif"}),e.poisLabel)])}]};var De=6378137,hr=85.0511287798,V=De*Math.PI,ur=e=>{let t=Math.PI/180,r=Math.max(Math.min(hr,e[0]),-hr),i=Math.sin(r*t);return new K.default(De*e[1]*t,De*Math.log((1+i)/(1-i))/2)},yi=e=>{var t=180/Math.PI;return{lat:(2*Math.atan(Math.exp(e.y/De))-Math.PI/2)*t,lng:e.x*t/De}},bi=(e,t)=>r=>{let i=ur(r);return new K.default((i.x+V)/(V*2),1-(i.y+V)/(V*2)).mult((1<<t)*256).sub(e)},gi=(e,t)=>r=>{console.log(r);let i=new K.default(r.x,r.y).add(e).div((1<<t)*256),n=new K.default(i.x*(V*2)-V,(1-i.y)*(V*2)-V);return yi(n)},ft=(e,t)=>{let r=t*(360/e);return Math.log2(r/256)},fr=class{constructor(t){let r=t.dark?ce:me;this.paint_rules=t.paint_rules||xe(r,t.shade),this.label_rules=t.label_rules||ye(r,t.shade,t.language1,t.language2);let i;t.url.url?i=new O(t.url,!1):t.url.endsWith(".pmtiles")?i=new O(t.url,!1):i=new oe(t.url,!1);let n=new le(i,1024);this.view=new ue(n,14,2),this.debug=t.debug||!1}drawContext(t,r,i,n,a){return D(this,null,function*(){let s=ur(n),l=new K.default((s.x+V)/(V*2),1-(s.y+V)/(V*2)).clone().mult(Math.pow(2,a)*256).sub(new K.default(r/2,i/2)),h={minX:l.x,minY:l.y,maxX:l.x+r,maxY:l.y+i},d=yield this.view.getBbox(a,h),c=performance.now(),p=new Pe(a,t,this.label_rules,void 0);for(var x of d)yield p.add(x);let b=Se(t,d,p.index,this.paint_rules,h,l,!0,this.debug);if(this.debug){t.save(),t.translate(-l.x,-l.y);for(var x of d)t.strokeStyle=this.debug,t.strokeRect(x.origin.x,x.origin.y,x.dim,x.dim);t.restore()}return{elapsed:performance.now()-c,project:bi(l,a),unproject:gi(l,a)}})}drawCanvas(a,s,o){return D(this,arguments,function*(t,r,i,n={}){let l=window.devicePixelRatio,h=t.clientWidth,d=t.clientHeight;t.sizeSet||(t.width=h*l,t.height=d*l,t.sizeSet=!0),t.lang=n.lang;let c=t.getContext("2d");return c.setTransform(l,0,0,l,0,0),this.drawContext(c,h,d,r,i)})}drawContextBounds(t,r,i,n,a){return D(this,null,function*(){let s=i[0]-r[0],o=[(r[1]+i[1])/2,(r[0]+i[0])/2];return this.drawContext(t,n,a,o,ft(s,n))})}drawCanvasBounds(s,o,l,h){return D(this,arguments,function*(t,r,i,n,a={}){let d=i[0]-r[0],c=[(r[1]+i[1])/2,(r[0]+i[0])/2];return this.drawCanvas(t,c,ft(d,n),a)})}};var dr=q(U());var mr=class{constructor(t){this.lang=t,this.unused=[]}get(t){if(this.unused.length){let i=this.unused.shift();return i.removed=!1,i}let r=L.DomUtil.create("canvas","leaflet-tile");return r.width=t,r.height=t,r.lang=this.lang,r}put(t){L.DomUtil.removeClass(t,"leaflet-tile-loaded"),this.unused.push(t)}},wi=e=>new Promise((t,r)=>{setTimeout(()=>{t()},e)}),vi=e=>{class t extends L.GridLayer{constructor(i){i.noWrap&&!i.bounds&&(i.bounds=[[-90,-180],[90,180]]),i.attribution||(i.attribution='<a href="https://protomaps.com">Protomaps</a> \xA9 <a href="https://openstreetmap.org/copyright">OpenStreetMap</a>'),super(i);let n=i.dark?ce:me;this.paint_rules=i.paint_rules||xe(n,i.shade),this.label_rules=i.label_rules||ye(n,i.shade,i.language1,i.language2),this.lastRequestedZ=void 0,this.xray=i.xray;let a;i.url.url?a=new O(i.url,!0):i.url.endsWith(".pmtiles")?a=new O(i.url,!0):a=new oe(i.url,!0);let s=14;i.maxDataZoom&&(s=i.maxDataZoom),this.levelDiff=i.levelDiff===void 0?2:i.levelDiff,this.tasks=i.tasks||[];let o=new le(a,256*1<<this.levelDiff);this.view=new ue(o,s,this.levelDiff),this.debug=i.debug;let l=document.createElement("canvas").getContext("2d");this.scratch=l,this.onTilesInvalidated=h=>{h.forEach(d=>{this.rerenderTile(d)})},this.labelers=new Ce(this.scratch,this.label_rules,this.onTilesInvalidated),this.tile_size=256*window.devicePixelRatio,this.pool=new mr(i.lang)}setDefaultStyle(i,n,a,s){let o=i?ce:me;this.paint_rules=xe(o,n),this.label_rules=ye(o,n,a,s)}renderTile(i,n,a,s=()=>{}){return D(this,null,function*(){this.lastRequestedZ=i.z;var o;try{o=yield this.view.getDisplayTile(i)}catch(y){if(y.name=="AbortError")return;throw y}if(n.key!=a||this.lastRequestedZ!==i.z||(yield Promise.allSettled(this.tasks),n.key!=a)||this.lastRequestedZ!==i.z)return;let l=yield this.labelers.add(o);if(n.key!=a||this.lastRequestedZ!==i.z)return;let h=this.labelers.getIndex(o.z);if(!this._map)return;let d=this._map.getCenter().wrap(),c=this._getTiledPixelBounds(d),p=this._pxBoundsToTileRange(c),x=p.getCenter(),b=i.distanceTo(x)*5;if(yield wi(b),n.key!=a||this.lastRequestedZ!==i.z)return;let w=16,u={minX:256*i.x-w,minY:256*i.y-w,maxX:256*(i.x+1)+w,maxY:256*(i.y+1)+w},f=new dr.default(256*i.x,256*i.y),m=n.getContext("2d");m.setTransform(this.tile_size/256,0,0,this.tile_size/256,0,0),m.clearRect(0,0,256,256);var g=0;if(this.xray?g=st(m,[o],u,f,!1,this.debug):g=Se(m,[o],h,this.paint_rules,u,f,!1,this.debug),this.debug){let y=o.data_tile;m.save(),m.fillStyle=this.debug,m.font="600 12px sans-serif",m.fillText(i.z+" "+i.x+" "+i.y,4,14),m.font="200 12px sans-serif",m.fillText(y.z+" "+y.x+" "+y.y,4,28),m.font="600 10px sans-serif",g>8&&m.fillText(g.toFixed()+" ms paint",4,42),l>8&&m.fillText(l.toFixed()+" ms layout",4,56),m.strokeStyle=this.debug,m.lineWidth=i.x/(1<<this.levelDiff)===y.x?2.5:.5,m.beginPath(),m.moveTo(0,0),m.lineTo(0,256),m.stroke(),m.lineWidth=i.y/(1<<this.levelDiff)===y.y?2.5:.5,m.beginPath(),m.moveTo(0,0),m.lineTo(256,0),m.stroke(),m.restore()}s()})}rerenderTile(i){for(let n in this._tiles){let a=this._wrapCoords(this._keyToTileCoords(n));i===this._tileCoordsToKey(a)&&this.renderTile(a,this._tiles[n].el,i)}}clearLayout(){this.labelers=new Ce(this.scratch,this.label_rules,this.onTilesInvalidated)}rerenderTiles(){for(let i in this._tiles){let n=this._wrapCoords(this._keyToTileCoords(i)),a=this._tileCoordsToKey(n);this.renderTile(n,this._tiles[i].el,a)}}createTile(i,n){let a=this.pool.get(this.tile_size),s=this._tileCoordsToKey(i);return a.key=s,this.renderTile(i,a,s,()=>{n(null,a)}),a}_removeTile(i){let n=this._tiles[i];!n||(n.el.removed=!0,n.el.key=void 0,L.DomUtil.remove(n.el),this.pool.put(n.el),delete this._tiles[i],this.fire("tileunload",{tile:n.el,coords:this._keyToTileCoords(i)}))}queryFeatures(i,n){return this.view.queryFeatures(i,n,this._map.getZoom())}addInspector(i){let n=["Point","Line","Polygon"];return i.on("click",a=>{let s=i.wrapLatLng(a.latlng),o=this.queryFeatures(s.lng,s.lat);for(var l="",h=0;h<o.length;h++){let d=o[h];l=l+`<div><b>${d.layerName}</b> ${n[d.feature.geomType-1]} ${d.feature.id}</div>`;for(let c in d.feature.props)l=l+`<div>${c}=${d.feature.props[c]}</div>`;h<o.length-1&&(l=l+"<hr/>")}o.length==0&&(l="No features."),L.popup().setLatLng(a.latlng).setContent(l).openOn(i)}),this}}return new t(e)};var _i=e=>{let t=0,r=0;for(let o of e)t+=o.w*o.h,r=Math.max(r,o.w);e.sort((o,l)=>l.h-o.h);let i=Math.max(Math.ceil(Math.sqrt(t/.95)),r),n=[{x:0,y:0,w:i,h:1/0}],a=0,s=0;for(let o of e)for(let l=n.length-1;l>=0;l--){let h=n[l];if(!(o.w>h.w||o.h>h.h)){if(o.x=h.x,o.y=h.y,s=Math.max(s,o.y+o.h),a=Math.max(a,o.x+o.w),o.w===h.w&&o.h===h.h){let d=n.pop();l<n.length&&(n[l]=d)}else o.h===h.h?(h.x+=o.w,h.w-=o.w):o.w===h.w?(h.y+=o.h,h.h-=o.h):(n.push({x:h.x+o.w,y:h.y,w:h.w-o.w,h:o.h}),h.y+=o.h,h.h-=o.h);break}}return{w:a,h:s,fill:t/(a*s)||0}},cr=e=>new Promise((t,r)=>{let i=new Image;i.onload=()=>t(i),i.onerror=()=>r("Invalid SVG"),i.src=e}),Fi=`
<svg width="20px" height="20px" viewBox="0 0 50 50" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <rect width="50" height="50" fill="#cccccc"/>
    <g transform="translate(5,5)">
        <path fill="none" stroke="#666666" stroke-width="7" d="m11,12a8.5,8 0 1,1 17,0q0,4-4,6t-4.5,4.5-.4,4v.2m0,3v7"/>
    </g>
</svg>
`,Ze=class{constructor(t){this.src=t,this.canvas=null}load(){return D(this,null,function*(){let t=this.src,r=window.devicePixelRatio;t.endsWith(".html")&&(t=yield(yield fetch(t)).text());let n=new window.DOMParser().parseFromString(t,"text/html").body.children;this.mapping={};let a=yield cr("data:image/svg+xml;base64,"+btoa(Fi)),s=[{w:a.width*r,h:a.height*r,img:a}],o=new XMLSerializer;for(let p of n){var l=btoa(o.serializeToString(p)),h="data:image/svg+xml;base64,"+l;let x=yield cr(h);s.push({w:x.width*r,h:x.height*r,img:x,id:p.id})}let d=_i(s);this.canvas=document.createElement("canvas"),this.canvas.width=d.w,this.canvas.height=d.h;let c=this.canvas.getContext("2d");for(let p of s)c.drawImage(p.img,p.x,p.y,p.w,p.h),p.id?this.mapping[p.id]={x:p.x,y:p.y,w:p.w,h:p.h}:this.missingBox={x:p.x,y:p.y,w:p.w,h:p.h};return this})}get(t){let r=this.mapping[t];return r||(r=this.missingBox),r.canvas=this.canvas,r}};var zi=(e,t,r)=>{let i=new FontFace(e,"url("+t+")",{weight:r});return document.fonts.add(i),i.load()},Li=e=>new Ze(e);function Xe(e){if(e.includes("$type"))return t=>!0;if(e[0]=="==")return(t,r)=>r.props[e[1]]===e[2];if(e[0]=="!=")return(t,r)=>r.props[e[1]]!==e[2];if(e[0]=="!"){let t=Xe(e[1]);return(r,i)=>!t(r,i)}else{if(e[0]==="<")return(t,r)=>r.props[e[1]]<e[2];if(e[0]==="<=")return(t,r)=>r.props[e[1]]<=e[2];if(e[0]===">")return(t,r)=>r.props[e[1]]>e[2];if(e[0]===">=")return(t,r)=>r.props[e[1]]>=e[2];if(e[0]==="in")return(t,r)=>e.slice(2,e.length).includes(r.props[e[1]]);if(e[0]==="!in")return(t,r)=>!e.slice(2,e.length).includes(r.props[e[1]]);if(e[0]==="has")return(t,r)=>r.props.hasOwnProperty(e[1]);if(e[0]==="!has")return(t,r)=>!r.props.hasOwnProperty(e[1]);if(e[0]==="all"){let t=e.slice(1,e.length).map(r=>Xe(r));return(r,i)=>t.every(n=>n(r,i))}else if(e[0]==="any"){let t=e.slice(1,e.length).map(r=>Xe(r));return(r,i)=>t.some(n=>n(r,i))}else return console.log("Unimplemented filter: ",e[0]),t=>!1}}function Ne(e){if(e.base&&e.stops)return r=>R(e.base,e.stops)(r-1);if(e[0]=="interpolate"&&e[1][0]=="exponential"&&e[2]=="zoom"){let r=e.slice(3),i=[];for(var t=0;t<r.length;t+=2)i.push([r[t],r[t+1]]);return n=>R(e[1][1],i)(n-1)}else if(e[0]=="step"&&e[1][0]=="get"){let r=e.slice(2),i=e[1][1];return(n,a)=>{let s=a.props[i];if(s<r[1])return r[0];for(t=1;t<r.length;t+=2)if(s<=r[t])return r[t+1];return r[r.length-1]}}else return console.log("Unimplemented numeric fn: ",e),r=>1}function dt(e,t=0){return e?typeof e=="number"?e:Ne(e):t}function mt(e,t){let r=dt(e,1),i=dt(t);return(n,a)=>{let s=typeof r=="number"?r:r(n,a);return i?s+(typeof i=="number"?i:i(n,a)):s}}function ct(e,t){let r=[];for(let o of e["text-font"])t.hasOwnProperty(o)&&r.push(t[o]);r.length===0&&r.push({face:"sans-serif"});let i=e["text-size"];var n="";r.length&&r[0].weight&&(n=r[0].weight+" ");var a="";if(r.length&&r[0].style&&(a=r[0].style+" "),typeof i=="number")return`${a}${n}${i}px ${r.map(o=>o.face).join(", ")}`;if(i.stops){var s=1.4;i.base&&(s=i.base);let o=Ne(i);return(l,h)=>`${a}${n}${o(l,h)}px ${r.map(d=>d.face).join(", ")}`}else if(i[0]=="step"){let o=Ne(i);return(l,h)=>`${a}${n}${o(l,h)}px ${r.map(d=>d.face).join(", ")}`}else return console.log("Can't parse font: ",e),o=>"12px sans-serif"}function Mi(e,t){let r=[],i=[],n=new Map;for(var a of e.layers){if(n.set(a.id,a),a.layout&&a.layout.visibility=="none")continue;if(a.ref){let h=n.get(a.ref);a.type=h.type,a.filter=h.filter,a.source=h.source,a["source-layer"]=h["source-layer"]}let l=a["source-layer"];var s,o=void 0;a.filter&&(o=Xe(a.filter)),a.type=="fill"?r.push({dataLayer:a["source-layer"],filter:o,symbolizer:new P({fill:a.paint["fill-color"],opacity:a.paint["fill-opacity"]})}):a.type=="fill-extrusion"?r.push({dataLayer:a["source-layer"],filter:o,symbolizer:new P({fill:a.paint["fill-extrusion-color"],opacity:a.paint["fill-extrusion-opacity"]})}):a.type=="line"?a.paint["line-dasharray"]?r.push({dataLayer:a["source-layer"],filter:o,symbolizer:new B({width:mt(a.paint["line-width"],a.paint["line-gap-width"]),dash:a.paint["line-dasharray"],dashColor:a.paint["line-color"]})}):r.push({dataLayer:a["source-layer"],filter:o,symbolizer:new B({color:a.paint["line-color"],width:mt(a.paint["line-width"],a.paint["line-gap-width"])})}):a.type=="symbol"?a.layout["symbol-placement"]=="line"?i.push({dataLayer:a["source-layer"],filter:o,symbolizer:new fe({font:ct(a.layout,t),fill:a.paint["text-color"],width:a.paint["text-halo-width"],stroke:a.paint["text-halo-color"],textTransform:a.layout["text-transform"],label_props:a.layout["text-field"]?[a.layout["text-field"]]:void 0})}):i.push({dataLayer:a["source-layer"],filter:o,symbolizer:new j({font:ct(a.layout,t),fill:a.paint["text-color"],stroke:a.paint["text-halo-color"],width:a.paint["text-halo-width"],textTransform:a.layout["text-transform"],label_props:a.layout["text-field"]?[a.layout["text-field"]]:void 0})}):a.type=="circle"&&r.push({dataLayer:a["source-layer"],filter:o,symbolizer:new N({radius:a.paint["circle-radius"],fill:a.paint["circle-color"],stroke:a.paint["circle-stroke-color"],width:a.paint["circle-stroke-width"]})})}return i.reverse(),{paint_rules:r,label_rules:i,tasks:[]}}return ki;})();
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
